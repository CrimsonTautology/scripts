#!/bin/sh

BUILD_DIR=$HOME/sourcemod/
PLUGIN_DIR=addons/sourcemod/plugins/

build_server(){
    local server=$1
    SOURCEMOD_DEV_SERVER=$server
    cd $BUILD_DIR

    echo "#########################"
    echo "Building Server ($server)"
    echo "#########################"
}

build(){
    local dir=$1
    cd $dir
    rake clean
    rake compile | egrep --color "warning|error"
    rake install
    cd $BUILD_DIR
}

remove_disabled(){
    cd $SOURCEMOD_DEV_SERVER
    cd $PLUGIN_DIR
    for f in $(ls disabled) ; do
        rm -f $f
    done
}

# fistful of frags - main
build_fof_main(){
    build_server $HOME/steamcmd/fof_main/fof/

    build admin_support
    build advanced_ads
    build analytics
    build autoupdater
    build death_chance_fof
    build dmr
    build drunk_fof
    build fashion_fof
    build killer_info_display
    build mapconfigs
    build mapfix_fof
    build navfile_blocker
    build randomize_teams_fof
    build resize_players
    build sourcebans-pp/game
    build super_kick_fof
    build voice_warn
    build weapon_only_fof
    build webshortcuts
    build word_filter

    remove_disabled
}

# fistful of frags - gun game
build_fof_gg(){
    build_server $HOME/steamcmd/fof_gg/fof/

    build admin_support
    build advanced_ads
    build analytics
    build autoupdater
    build death_chance_fof
    build dmr
    build drunk_fof
    build fashion_fof
    build gungame_fof
    build killer_info_display
    build mapconfigs
    build navfile_blocker
    build mapfix_fof
    build randomize_teams_fof
    build resize_players
    build sourcebans-pp/game
    build super_kick_fof
    build voice_warn
    build webshortcuts
    build word_filter

    remove_disabled
}

# fistful of frags - gun game (12 man)
build_fof_gg2(){
    build_server $HOME/steamcmd/fof_gg2/fof/

    build admin_support
    build advanced_ads
    build analytics
    build autoupdater
    build death_chance_fof
    build dmr
    build drunk_fof
    build fashion_fof
    build gungame_fof
    build killer_info_display
    build mapconfigs
    build navfile_blocker
    build mapfix_fof
    build randomize_teams_fof
    build resize_players
    build sourcebans-pp/game
    build super_kick_fof
    build voice_warn
    build weapon_only_fof
    build webshortcuts
    build word_filter

    remove_disabled
}

# fistful of frags - zombies
build_fof_foz(){
    build_server $HOME/steamcmd/fof_foz/fof/

    build admin_support
    build advanced_ads
    build analytics
    build death_chance_fof
    build dmr
    build drunk_fof
    build fashion_fof
    build foz
    build killer_info_display
    build mapconfigs
    build mapfix_fof
    build navfile_blocker
    build randomize_teams_fof
    build sourcebans-pp/game
    build super_kick_fof
    build voice_warn
    build weapon_mod
    build weapon_only_fof
    build webshortcuts
    build word_filter

    remove_disabled
}


# fistful of frags - mario kart
build_fof_mk(){
    build_server $HOME/steamcmd/fof_mk/fof/

    build admin_support
    build advanced_ads
    build analytics
    build autoupdater
    build death_chance_fof
    build dmr
    build drunk_fof
    build fashion_fof
    build killer_info_display
    build mapconfigs
    build mapfix_fof
    build navfile_blocker
    build near_map_end_fof
    build randomize_teams_fof
    build resize_players
    build sourcebans-pp/game
    build super_kick_fof
    build voice_warn
    build weapon_only_fof
    build webshortcuts
    build word_filter

    remove_disabled
}

# build plugins for servers

build_fof_main
build_fof_gg
build_fof_gg2
build_fof_mk
build_fof_foz
